<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="../vendor/jquery/jquery.min.js"></script>
    <!--<script src="../lib/amf.js"></script>-->
    <!--<script src="../lib/binary.js"></script>-->
    <script src="../lib/alt.js"></script>

    <script type="text/javascript">
        (function() {

            var url = "http://localhost.dev/projects/amf.js/server.php";

            var connection = new amf.AMFConnection(url, 3);
            connection.addEventListener("fault", function(event) {
                log(event.cause);
                event.stopPropagation();
            }, true);
            connection.onerror = function(event) {
                log(event.cause);
            }

            var future = connection.execute("myMath.sum", [1, 2]);
            future.onresult = function(event) {
                alert("1 + 2 = " + event.result);
            }

            var obj = {
                $alias: "com.foo.Obj",
                message: "hello"
            }
            connection.execute("echo.echo", [obj]).onresult = function(event) {
                alert(event.result + " from server!");
            }

            return;

            var serialize = function (data) {
                var serializer = new AMFSerializer(amf.AMF3);
                return serializer.writeValue(data);
            };

            function ab2str(buf) {
                return String.fromCharCode.apply(null, new Uint16Array(buf));
            }

            function str2ab(str) {
                var buf = new ArrayBuffer(str.length*2); // 2 bytes for each char
                var bufView = new Uint16Array(buf);
                for (var i=0, strLen=str.length; i<strLen; i++) {
                    bufView[i] = str.charCodeAt(i);
                }
                return buf;
            }

//            var d = serialize({hi:'greetings!'});
//            console.log(d, Base64.encodeByteArray());

//            var d2 = str2ab(d);

            var Packet = amf.packet();

            // add a simple header with a name and string value
//            Packet.addHeader( 'header 1', 'Example header 1' );
//            Packet.addHeader( 'header 2', 'Example header 2' );

            // Dummy request/response URIs
            var requestURI = '/1/onResult';
            var responseURI = '/1';

            // add construct as a single AMF message and return serialized, binary string
//            for( var t = 0, n = 0; t < tests.length; t++ ){
//                var struct = {};
//                var descr = tests[t][0];
//                var value = tests[t][1];
//                struct[descr] = value;
//            }


            Packet.addMessage( {hi: serialize('hello world')}, requestURI, responseURI );

            // dump test packet in hex display
            var bin = Packet.serialize();

            debugger;

            $.ajax({
                url: "http://localhost.dev/projects/amf.js/server.php",
                type: "POST",
                data: bin,
                contentType:'application/x-amf',
                processData: false
            });
        })();
    </script>
</head>
<body>

</body>
</html>